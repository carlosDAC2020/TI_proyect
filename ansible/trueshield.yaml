- name: Configuracion general
  hosts: all
  remote_user: ubuntu
  gather_facts: no
  tasks:
    - name: Actualizar la lista de paquetes en todos los servidores
      become: yes
      apt:
        update_cache: yes
    
    - name: Instalar Docker en todos los servidores
      become: yes
      apt:
        name: docker.io
        state: present

    - name: Iniciar el servicio de Docker en todos los servidores
      become: yes
      service:
        name: docker
        state: started
        enabled: yes

    - name: Iniciar el servicio de Docker en todos los servidores
      become: yes
      command: sudo usermod -aG docker $USER


- name: Configuracion para el manager server
  hosts: server1
  remote_user: ubuntu
  gather_facts: no
  tasks:
    - name: Descarga de imagen de aplicacion   
      become: yes
      command: sudo docker pull cdapdev2020/dj-manager-server:20240505020942

    - name: Arrancar el container 
      become: yes
      command: sudo docker run -d -p 80:8000 -e HHOST_IP=100.26.34.38  -e DB_USER=postgres -e DB_PASSWORD=j2uPsPyhcqb3tPyNdrbu -e DB_HOST=trueshield.cl0mwigse4do.us-east-1.rds.amazonaws.com -e DB_NAME=FKNDetector cdapdev2020/dj-manager-server:20240505020942


 